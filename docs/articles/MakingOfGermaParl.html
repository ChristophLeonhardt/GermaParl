<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GermaParl - From XML to CWB • GermaParl</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GermaParl - From XML to CWB">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GermaParl</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/GermaParl.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MakingOfGermaParl.html">GermaParl - From XML to CWB</a>
    </li>
    <li>
      <a href="../articles/Topicmodelling.html">Adding topicmodels to GermaParl</a>
    </li>
    <li>
      <a href="../articles/UsingCAPAnnotation.html">Using the GermaParl Annotation</a>
    </li>
    <li>
      <a href="../articles/UsingTopicAnnotation.html">Using the topic annotation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>GermaParl - From XML to CWB</h1>
                        <h4 class="author">Andreas Blätte (<a href="mailto:andreas.blaette@uni-due.de">andreas.blaette@uni-due.de</a>)</h4>
            
            <h4 class="date">2018-07-15</h4>
      
      
      <div class="hidden name"><code>MakingOfGermaParl.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">Sys.time</span>()</a></code></pre></div>
</div>
<div id="initialization" class="section level1">
<h1 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h1>
<div id="setting-parameters-and-global-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-parameters-and-global-variables" class="anchor"></a>Setting parameters and global variables</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">Sys.setenv</span>(<span class="st">"TREETAGGER_PATH"</span> =<span class="st"> "/opt/treetagger"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">Sys.setenv</span>(<span class="st">"CORENLP_PATH"</span> =<span class="st"> "/opt/stanford-corenlp/stanford-corenlp-full-2017-06-09"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(ctk)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">packageVersion</span>(<span class="st">"ctk"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">java.parameters =</span> <span class="st">"-Xmx4g"</span>) <span class="co"># needs to be set before a JVM is initialized.</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">options</span>(<span class="st">"polmineR.cwb-regedit"</span> =<span class="st"> </span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">noCores &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/detectCores">detectCores</a></span>() <span class="op">-</span><span class="st"> </span>2L</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># noCores &lt;- 1L</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">pipeDir &lt;-<span class="st"> "/hd/pipeDirs/GermaParl"</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">sourceDir &lt;-<span class="st"> "~/Lab/github/GermaParlTEI"</span></a></code></pre></div>
</div>
</div>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">P &lt;-<span class="st"> </span>PipeCoreNLP<span class="op">$</span><span class="kw">new</span>(<span class="dt">dir =</span> pipeDir, <span class="dt">threads =</span> noCores)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">P<span class="op">$</span><span class="kw">preparePipeDir</span>(<span class="dt">subdirs =</span> <span class="kw">c</span>(<span class="st">"xml"</span>, <span class="st">"tsv"</span>, <span class="st">"tok"</span>, <span class="st">"ndjson"</span>), <span class="dt">delete =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">P<span class="op">$</span><span class="kw">getFiles</span>(<span class="dt">sourceDir =</span> sourceDir, <span class="dt">pattern =</span> <span class="st">"xml"</span>, <span class="dt">targetDir =</span> <span class="st">"xml"</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="generate-basetable" class="section level1">
<h1 class="hasAnchor">
<a href="#generate-basetable" class="anchor"></a>Generate Basetable</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">metadata &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">lp =</span> <span class="st">"//legislativePeriod"</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">session =</span> <span class="st">"//titleStmt/sessionNo"</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">date =</span> <span class="st">"//publicationStmt/date"</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">url =</span> <span class="st">"//sourceDesc/url"</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="dt">src =</span> <span class="st">"//sourceDesc/filetype"</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">basetable &lt;-<span class="st"> </span>P<span class="op">$</span><span class="kw">xmlToDT</span>(<span class="dt">metadata =</span> metadata, <span class="dt">sourceDir =</span> <span class="st">"xml"</span>, <span class="dt">targetDir =</span> <span class="st">"tsv"</span>)</a></code></pre></div>
<p>Some adjustments and some cleaning.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">basetable &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="kw">file.path</span>(P<span class="op">$</span>dir, <span class="st">"tsv"</span>, <span class="st">"basetable.tsv"</span>),</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">showProgress =</span> <span class="kw">interactive</span>()</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># When reading in basetable.tsv, "191. Sitzung" in the 'session'-column</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co"># may cause a warning from data.table::fread - remove ". Sitzung" immediately</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">basetable[, session <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">"^.*?(</span><span class="ch">\\</span><span class="st">d+)</span><span class="ch">\\</span><span class="st">..*?$"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1"</span>, basetable[[<span class="st">"session"</span>]])] </a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co"># remove text in speaker tag</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">basetable &lt;-<span class="st"> </span>basetable[<span class="kw">is.na</span>(speaker)][, speaker <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>] </a>
<a class="sourceLine" id="cb7-12" data-line-number="12"></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co"># remove columns that are not used later on</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="cf">for</span> (x <span class="cf">in</span> <span class="kw">c</span>(<span class="st">"div_desc"</span>, <span class="st">"body"</span>, <span class="st">"TEI"</span>, <span class="st">"p"</span>)) basetable[[x]] &lt;-<span class="st"> </span><span class="ot">NULL</span> </a>
<a class="sourceLine" id="cb7-15" data-line-number="15"></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co"># turn NAs or blank slots in interjection to speech / interjection</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17">basetable[[<span class="st">"stage_type"</span>]] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(basetable[[<span class="st">"stage_type"</span>]] <span class="op">==</span><span class="st"> ""</span>, <span class="ot">NA</span>, basetable[[<span class="st">"stage_type"</span>]] <span class="op">==</span><span class="st"> ""</span>)</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">basetable[[<span class="st">"stage_type"</span>]] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(basetable[[<span class="st">"stage_type"</span>]]), <span class="st">"speech"</span>, <span class="st">"interjection"</span> )</a>
<a class="sourceLine" id="cb7-19" data-line-number="19"></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co"># write consolidated basetable to disk</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21">data.table<span class="op">::</span><span class="kw">fwrite</span>(basetable, <span class="kw">file.path</span>(P<span class="op">$</span>dir, <span class="st">"tsv"</span>, <span class="st">"basetable.tsv"</span>), <span class="dt">showProgress =</span> <span class="kw">interactive</span>())</a></code></pre></div>
<p>Take appart the basetable, and save results to tsv subdir.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">P<span class="op">$</span><span class="kw">makeMetadataTable</span>(<span class="dt">sourceDir =</span> <span class="st">"tsv"</span>, <span class="dt">targetDir =</span> <span class="st">"tsv"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">P<span class="op">$</span><span class="kw">makePlaintextTable</span>(<span class="dt">sourceDir =</span> <span class="st">"tsv"</span>, <span class="dt">targetDir =</span> <span class="st">"tsv"</span>)</a></code></pre></div>
</div>
<div id="annotation-using-stanford-corenlp" class="section level1">
<h1 class="hasAnchor">
<a href="#annotation-using-stanford-corenlp" class="anchor"></a>Annotation using Stanford CoreNLP</h1>
<p>Here we do the actual annotation, the most time consuming part of the exercies. Parallelisation is possible, but will require seperate JVMs to be created by forked processes. It will fail, if a JVM has been initialized by R before that - take care.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">P<span class="op">$</span><span class="kw">corenlp</span>(<span class="dt">sourceDir =</span> <span class="st">"tsv"</span>, <span class="dt">targetDir =</span> <span class="st">"ndjson"</span>)</a></code></pre></div>
</div>
<div id="turn-ndjson-to-csv" class="section level1">
<h1 class="hasAnchor">
<a href="#turn-ndjson-to-csv" class="anchor"></a>turn NDJSON to csv</h1>
<p>We have ‘ndjson’ output at this stage. This needs to be turned into a vertical / tabular format. No parallelization here so far, as the procedure is still reasonably fast (~ 1,5 h).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">P<span class="op">$</span><span class="kw">ndjsonToDf</span>(<span class="dt">sourceDir =</span> <span class="st">"ndjson"</span>, <span class="dt">targetDir =</span> <span class="st">"tsv"</span>)</a></code></pre></div>
</div>
<div id="treetagging" class="section level1">
<h1 class="hasAnchor">
<a href="#treetagging" class="anchor"></a>treetagging</h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">P<span class="op">$</span><span class="kw">addTreetaggerLemmatization</span>(<span class="dt">sourceDir =</span> <span class="st">"tsv"</span>, <span class="dt">targetDir =</span> <span class="st">"tsv"</span>)</a></code></pre></div>
</div>
<div id="import-corpus-into-cwb" class="section level1">
<h1 class="hasAnchor">
<a href="#import-corpus-into-cwb" class="anchor"></a>Import corpus into CWB</h1>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">Enc &lt;-<span class="st"> </span>Encoder<span class="op">$</span><span class="kw">new</span>(<span class="dt">corpus =</span> <span class="st">"germaparl"</span>, <span class="dt">encoding =</span> <span class="st">"latin1"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">Enc<span class="op">$</span>tokenstream &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw">file.path</span>(P<span class="op">$</span>dir, <span class="st">"tsv"</span>, <span class="st">"tokenstream.tsv"</span>), <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">showProgress =</span> <span class="kw">interactive</span>()</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># CoreNLP annotation turns round/square/curly brackets into acronyms - redo that here.</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">wordSubs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  <span class="kw">c</span>(<span class="st">"-LRB-"</span>, <span class="st">"("</span>),</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="kw">c</span>(<span class="st">"-RRB-"</span>, <span class="st">")"</span>),</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">  <span class="kw">c</span>(<span class="st">"-LSB-"</span>, <span class="st">"["</span>),</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">  <span class="kw">c</span>(<span class="st">"-RSB-"</span>, <span class="st">"]"</span>),</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">  <span class="kw">c</span>(<span class="st">"-RCB-"</span>, <span class="st">"}"</span>)</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(wordSubs)){</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">  <span class="cf">if</span> (<span class="kw">interactive</span>()) <span class="kw">message</span>(<span class="st">"... replacement: "</span>, i)</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">  Enc<span class="op">$</span>tokenstream[, word <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(wordSubs[[i]][<span class="dv">1</span>], wordSubs[[i]][<span class="dv">2</span>], Enc<span class="op">$</span>tokenstream[[<span class="st">"word"</span>]])]</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb13-18" data-line-number="18"></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co"># gsub is remarkably slow ...</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20">Enc<span class="op">$</span>tokenstream[, lemma <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">"^&lt;unknown&gt;$"</span>, <span class="st">"#unknown#"</span>, Enc<span class="op">$</span>tokenstream[[<span class="st">"lemma"</span>]])]</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">Enc<span class="op">$</span>metadata &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="kw">file.path</span>(P<span class="op">$</span>dir, <span class="st">"tsv"</span>, <span class="st">"metadata.tsv"</span>),</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="dt">showProgress =</span> <span class="kw">interactive</span>()</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">data.table<span class="op">::</span><span class="kw">setnames</span>(</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  Enc<span class="op">$</span>metadata,</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">  <span class="dt">old =</span> <span class="kw">c</span>(<span class="st">"sp_party"</span>, <span class="st">"sp_name"</span>, <span class="st">"sp_role"</span>, <span class="st">"sp_parliamentary_group"</span>, <span class="st">"stage_type"</span>, <span class="st">"div_n"</span>, <span class="st">"div_what"</span>),</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  <span class="dt">new =</span> <span class="kw">c</span>(<span class="st">"party"</span>, <span class="st">"speaker"</span>, <span class="st">"role"</span>, <span class="st">"parliamentary_group"</span>, <span class="st">"interjection"</span>, <span class="st">"agenda_item"</span>, <span class="st">"agenda_item_type"</span>)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11">Enc<span class="op">$</span>metadata[, interjection  <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(Enc<span class="op">$</span>metadata[[<span class="st">"interjection"</span>]] <span class="op">==</span><span class="st"> "interjection"</span>, <span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>)]</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">aiSubs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">  <span class="kw">c</span>(<span class="st">"^NA$"</span>, <span class="st">""</span>), </a>
<a class="sourceLine" id="cb14-15" data-line-number="15">  <span class="kw">c</span>(<span class="st">"^debate</span><span class="ch">\\</span><span class="st">|recent_issues</span><span class="ch">\\</span><span class="st">|debate$"</span>, <span class="st">"debate|recent_issues"</span>),</a>
<a class="sourceLine" id="cb14-16" data-line-number="16">  <span class="kw">c</span>(<span class="st">"^1$"</span>, <span class="st">""</span>),</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">  <span class="kw">c</span>(<span class="st">"^debate</span><span class="ch">\\</span><span class="st">|debate$"</span>, <span class="st">"debate"</span>)</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(aiSubs)){</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">  <span class="cf">if</span> (<span class="kw">interactive</span>()) <span class="kw">message</span>(<span class="st">"... replacement: "</span>, i)</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">  Enc<span class="op">$</span>metadata[, agenda_item_type <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(aiSubs[[i]][<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb14-22" data-line-number="22">                                          aiSubs[[i]][<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb14-23" data-line-number="23">                                          Enc<span class="op">$</span>metadata[[<span class="st">"agenda_item_type"</span>]])]</a>
<a class="sourceLine" id="cb14-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb14-25" data-line-number="25"></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"></a>
<a class="sourceLine" id="cb14-27" data-line-number="27">partySubs =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-28" data-line-number="28">  <span class="kw">c</span>(<span class="st">"^CDU.*$"</span>, <span class="st">"CDU"</span>),</a>
<a class="sourceLine" id="cb14-29" data-line-number="29">  <span class="kw">c</span>(<span class="st">"Grüne", "</span>GRUENE<span class="st">"),</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30"><span class="st">  c("</span>BÜNDNIS <span class="dv">90</span><span class="op">/</span><span class="st"> </span>DIE GRÜNEN<span class="st">", "</span>GRUENE<span class="st">"),</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="st">  c("</span>BÜNDNIS <span class="dv">90</span><span class="op">/</span>DIE GRÜNEN<span class="st">", "</span>GRUENE<span class="st">"),</span></a>
<a class="sourceLine" id="cb14-32" data-line-number="32"><span class="st">  c("</span>Bündnis <span class="dv">90</span><span class="op">/</span>Die Grünen", <span class="st">"GRUENE"</span>),</a>
<a class="sourceLine" id="cb14-33" data-line-number="33">  <span class="kw">c</span>(<span class="st">"Bündnis 90/Die GRUENEn"</span>, <span class="st">"GRUENE"</span>),</a>
<a class="sourceLine" id="cb14-34" data-line-number="34">  <span class="kw">c</span>(<span class="st">"GRÜNE"</span>, <span class="st">"GRUENE"</span>),</a>
<a class="sourceLine" id="cb14-35" data-line-number="35">  <span class="kw">c</span>(<span class="st">"Die Linke"</span>, <span class="st">"LINKE"</span>),</a>
<a class="sourceLine" id="cb14-36" data-line-number="36">  <span class="kw">c</span>(<span class="st">"DIE LINKE"</span>, <span class="st">"LINKE"</span>),</a>
<a class="sourceLine" id="cb14-37" data-line-number="37">  <span class="kw">c</span>(<span class="st">"parteilos</span><span class="ch">\\</span><span class="st">(auf Vorschlag der SPD</span><span class="ch">\\</span><span class="st">)"</span>, <span class="st">"parteilos"</span>)</a>
<a class="sourceLine" id="cb14-38" data-line-number="38">)</a>
<a class="sourceLine" id="cb14-39" data-line-number="39"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(partySubs)){</a>
<a class="sourceLine" id="cb14-40" data-line-number="40">  <span class="cf">if</span> (<span class="kw">interactive</span>()) <span class="kw">message</span>(<span class="st">"... replacement: "</span>, i)</a>
<a class="sourceLine" id="cb14-41" data-line-number="41">  Enc<span class="op">$</span>metadata[, party <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(partySubs[[i]][<span class="dv">1</span>], partySubs[[i]][<span class="dv">2</span>], Enc<span class="op">$</span>metadata[[<span class="st">"party"</span>]])]</a>
<a class="sourceLine" id="cb14-42" data-line-number="42">}</a>
<a class="sourceLine" id="cb14-43" data-line-number="43"></a>
<a class="sourceLine" id="cb14-44" data-line-number="44">pgSubs =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-45" data-line-number="45">  <span class="kw">c</span>(<span class="st">"^F</span><span class="ch">\\</span><span class="st">.D</span><span class="ch">\\</span><span class="st">.P</span><span class="ch">\\</span><span class="st">.$$"</span>, <span class="st">"FDP"</span>),</a>
<a class="sourceLine" id="cb14-46" data-line-number="46">  <span class="kw">c</span>(<span class="st">"Grüne", "</span>GRUENE<span class="st">"),</span></a>
<a class="sourceLine" id="cb14-47" data-line-number="47"><span class="st">  c("</span>BÜNDNIS <span class="dv">90</span><span class="op">/</span>DIE GRÜNEN<span class="st">", "</span>GRUENE<span class="st">"),</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48"><span class="st">  c("</span>DIE LINKE<span class="st">", "</span>LINKE<span class="st">")</span></a>
<a class="sourceLine" id="cb14-49" data-line-number="49"><span class="st">)</span></a>
<a class="sourceLine" id="cb14-50" data-line-number="50"></a>
<a class="sourceLine" id="cb14-51" data-line-number="51"><span class="st">for (i in 1:length(pgSubs)){</span></a>
<a class="sourceLine" id="cb14-52" data-line-number="52"><span class="st">  if (interactive()) message("</span>... replacement<span class="op">:</span><span class="st"> ", i)</span></a>
<a class="sourceLine" id="cb14-53" data-line-number="53"><span class="st">  Enc$metadata[, parliamentary_group := gsub(pgSubs[[i]][1], pgSubs[[i]][2],</span></a>
<a class="sourceLine" id="cb14-54" data-line-number="54"><span class="st">                                             Enc$metadata[["</span>parliamentary_group<span class="st">"]])]</span></a>
<a class="sourceLine" id="cb14-55" data-line-number="55"><span class="st">}</span></a>
<a class="sourceLine" id="cb14-56" data-line-number="56"></a>
<a class="sourceLine" id="cb14-57" data-line-number="57"><span class="st">Enc$metadata[, year := gsub("</span><span class="op">^</span>(\\d{<span class="dv">4</span>})<span class="op">-</span>\\d{<span class="dv">2</span>}<span class="op">-</span>\\d<span class="op">+</span><span class="er">$</span><span class="st">", "</span>\\<span class="dv">1</span><span class="st">", Enc$metadata[["</span>date<span class="st">"]])]</span></a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">Enc<span class="op">$</span><span class="kw">encode</span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="dt">pAttributes =</span> <span class="kw">c</span>(<span class="st">"word"</span>, <span class="st">"pos"</span>, <span class="st">"lemma"</span>),</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">sAttributes =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    <span class="st">"party"</span>, <span class="st">"parliamentary_group"</span>, <span class="st">"speaker"</span>, <span class="st">"lp"</span>, <span class="st">"session"</span>,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="st">"date"</span>, <span class="st">"role"</span>, <span class="st">"interjection"</span>, <span class="st">"agenda_item"</span>, <span class="st">"agenda_item_type"</span>,</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    <span class="st">"src"</span>, <span class="st">"url"</span>, <span class="st">"year"</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  )</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">file.copy</span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="dt">from =</span> <span class="st">"~/Lab/gitlab/GermaParl/data-raw/template.json"</span>,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">to =</span> <span class="kw">file.path</span>(RegistryFile<span class="op">$</span><span class="kw">new</span>(<span class="st">"GERMAPARL"</span>)<span class="op">$</span><span class="kw">getHome</span>(), <span class="st">"template.json"</span>),</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="dt">overwrite =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  )</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">RF &lt;-<span class="st"> </span>RegistryFile<span class="op">$</span><span class="kw">new</span>(<span class="st">"GERMAPARL"</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">RF<span class="op">$</span><span class="kw">setProperty</span>(<span class="dt">property =</span> <span class="st">"type"</span>, <span class="dt">value =</span> <span class="st">"plpr"</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">RF<span class="op">$</span><span class="kw">setProperty</span>(<span class="dt">property =</span> <span class="st">"language"</span>, <span class="dt">value =</span> <span class="st">"de"</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">RF<span class="op">$</span><span class="kw">write</span>()</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">newInfoFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(RegistryFile<span class="op">$</span><span class="kw">new</span>(<span class="st">"GERMAPARL"</span>)<span class="op">$</span><span class="kw">getHome</span>(), <span class="st">".info.md"</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">file.copy</span>(</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  <span class="dt">from =</span> <span class="st">"~/Lab/gitlab/GermaParl/data-raw/info.md"</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="dt">to =</span> newInfoFile, <span class="dt">overwrite =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">RF &lt;-<span class="st"> </span>RegistryFile<span class="op">$</span><span class="kw">new</span>(<span class="st">"GERMAPARL"</span>)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">RF<span class="op">$</span><span class="kw">setInfo</span>(<span class="dt">new =</span> newInfoFile)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">RF<span class="op">$</span><span class="kw">write</span>()</a></code></pre></div>
</div>
<div id="final-check" class="section level1">
<h1 class="hasAnchor">
<a href="#final-check" class="anchor"></a>Final check</h1>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">library</span>(polmineR)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/polmineR/topics/use">use</a></span>() <span class="co"># to make the new corpus available</span></a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">toCheck &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"party"</span>, <span class="st">"parliamentary_group"</span>, <span class="st">"lp"</span>, <span class="st">"role"</span>, <span class="st">"interjection"</span>, <span class="st">"agenda_item_type"</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="cf">for</span> (x <span class="cf">in</span> toCheck){</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  <span class="kw">print</span>(x)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  <span class="kw">print</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/polmineR/topics/renamed">sAttributes</a></span>(<span class="st">"GERMAPARL"</span>, x))</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">}</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">Sys.time</span>()</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#initialization">Initialization</a><ul class="nav nav-pills nav-stacked">
<li><a href="#setting-parameters-and-global-variables">Setting parameters and global variables</a></li>
      </ul>
</li>
      <li><a href="#getting-started">Getting started</a></li>
      <li><a href="#generate-basetable">Generate Basetable</a></li>
      <li><a href="#annotation-using-stanford-corenlp">Annotation using Stanford CoreNLP</a></li>
      <li><a href="#turn-ndjson-to-csv">turn NDJSON to csv</a></li>
      <li><a href="#treetagging">treetagging</a></li>
      <li><a href="#import-corpus-into-cwb">Import corpus into CWB</a></li>
      <li><a href="#final-check">Final check</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andreas Blaette Developer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
